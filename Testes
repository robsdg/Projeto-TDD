#Teste de integração
from fastapi.testclient import TestClient
from app.main import app

client = TestClient(app)

def test_create_user_integration():
    response = client.post("/users", json={"name": "Robson", "email": "robson@email.com"})
    assert response.status_code == 200
    data = response.json()
    assert data["name"] == "Robson"
    assert "_id" in data

#Teste
from app.crud import create_user
from app.models import User

def test_create_user_unit(monkeypatch):
    # simula o insert_one do Mongo
    def fake_insert_one(data):
        class Result:
            inserted_id = "123456789"
        return Result()

    monkeypatch.setattr("app.crud.users_collection.insert_one", fake_insert_one)

    user = User(name="Robson", email="robson@email.com")
    result = create_user(user)

    assert result["name"] == "Robson"
    assert result["_id"] == "123456789"
